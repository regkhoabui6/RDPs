name: üöÄ SEVER AI STV PREMIUM

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Th·ªùi gian s·ª≠ d·ª•ng'
        required: false
        default: '5h40m'
        type: choice
        options:
          - '1h'
          - '3h'
          - '5h40m'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-latest
    timeout-minutes: 340

    steps:
      # üßπ DEBLOAT EXTREME - L√ÄM WINDOWS SI√äU S·∫†CH
      - name: üßπ DEBLOAT EXTREME - XO√Å S·∫†CH TH·ª® TH·ª™A
        shell: powershell
        run: |
          Write-Host "üßπ ƒêANG DEBLOAT C·ª∞C M·∫†NH..." -ForegroundColor Yellow
          
          # Xo√° Visual Studio 2022 Enterprise
          $vsInstaller = "C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installer.exe"
          if (Test-Path $vsInstaller) {
            Start-Process $vsInstaller -ArgumentList "--quiet --uninstall --force --norestart" -Wait
          }
          Remove-Item "C:\Program Files\Microsoft Visual Studio" -Recurse -Force -ErrorAction SilentlyContinue
          Remove-Item "C:\Program Files (x86)\Microsoft Visual Studio" -Recurse -Force -ErrorAction SilentlyContinue
          Remove-Item "C:\ProgramData\Microsoft\VisualStudio" -Recurse -Force -ErrorAction SilentlyContinue
          
          # Xo√° Chocolatey
          if (Test-Path $env:ChocolateyInstall) {
            Remove-Item $env:ChocolateyInstall -Recurse -Force -ErrorAction SilentlyContinue
          }
          Remove-Item "C:\ProgramData\chocolatey" -Recurse -Force -ErrorAction SilentlyContinue
          
          # Xo√° Python, Node.js, Android SDK
          Remove-Item "C:\Python*" -Recurse -Force -ErrorAction SilentlyContinue
          Remove-Item "C:\Program Files\nodejs" -Recurse -Force -ErrorAction SilentlyContinue
          Remove-Item "C:\Android" -Recurse -Force -ErrorAction SilentlyContinue
          
          # Clean PATH - ch·ªâ gi·ªØ t·ªëi thi·ªÉu c·∫ßn thi·∫øt
          $essential = @(
            "C:\Windows\system32"
            "C:\Windows"
            "C:\Windows\System32\Wbem"
            "C:\Windows\System32\WindowsPowerShell\v1.0\"
            "C:\Windows\System32\OpenSSH\"
            "C:\Program Files\Git\cmd"
            "C:\Program Files\PowerShell\7\"
          )
          $newPath = ($essential -join ";") + ";"
          [System.Environment]::SetEnvironmentVariable('PATH', $newPath, 'Machine')
          $env:PATH = $newPath
          
          # D·ªçn temp
          Remove-Item "C:\Users\runneradmin\AppData\Local\Temp\*" -Recurse -Force -ErrorAction SilentlyContinue
          
          Write-Host "üéâ DEBLOAT HO√ÄN T·∫§T! Windows s·∫°ch m·∫°nh!" -ForegroundColor Green

      # üéØ KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG
      - name: üéØ KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG
        run: |
          Write-Host ""
          Write-Host ""
          Write-Host "ü§ñ AI STV PREMIUM RDP SERVER" -ForegroundColor Yellow
          Write-Host "‚ö° Powered by AI STV" -ForegroundColor Green
          Write-Host "üïí Th·ªùi gian: ${{ github.event.inputs.duration }}" -ForegroundColor Magenta
          Write-Host ""
          
          $frames = @('‚£æ', '‚£Ω', '‚£ª', '‚¢ø', '‚°ø', '‚£ü', '‚£Ø', '‚£∑')
          for($i=0; $i -lt 10; $i++) {
            Write-Host "`rüöÄ ƒêang kh·ªüi t·∫°o h·ªá th·ªëng... $($frames[$i % 8])" -NoNewline -ForegroundColor Blue
            Start-Sleep -Milliseconds 100
          }
          Write-Host "`r‚úÖ H·ªá th·ªëng ƒë√£ s·∫µn s√†ng!                    " -ForegroundColor Green

      # üîß C·∫§U H√åNH H·ªÜ TH·ªêNG
      - name: üîß C·∫§U H√åNH H·ªÜ TH·ªêNG
        run: |
          Write-Host ""
          Write-Host "üõ†Ô∏è  ƒêANG C·∫§U H√åNH H·ªÜ TH·ªêNG" -ForegroundColor Yellow
          
          $steps = @(
            @{Name="B·∫≠t Remote Desktop"; Script={ 
              Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
            }},
            @{Name="T·∫Øt x√°c th·ª±c m·∫°ng"; Script={
              Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
            }},
            @{Name="C·∫•u h√¨nh b·∫£o m·∫≠t RDP"; Script={
              Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
              Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
            }},
            @{Name="M·ªü port 3389 firewall"; Script={
              netsh advfirewall firewall add rule name="RDP-Premium" dir=in action=allow protocol=TCP localport=3389 profile=any
              netsh advfirewall firewall add rule name="RDP-Premium-Out" dir=out action=allow protocol=TCP localport=3389 profile=any
            }},
            @{Name="Kh·ªüi ƒë·ªông d·ªãch v·ª•"; Script={
              Set-Service -Name TermService -StartupType Automatic -ErrorAction SilentlyContinue
              Set-Service -Name UmRdpService -StartupType Automatic -ErrorAction SilentlyContinue
              Start-Service -Name TermService -ErrorAction SilentlyContinue
              Start-Service -Name UmRdpService -ErrorAction SilentlyContinue
            }}
          )
          
          foreach($step in $steps) {
            Write-Host "‚îÇ üìã $($step.Name)..." -NoNewline -ForegroundColor White
            try {
              & $step.Script
              Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
            } catch {
              Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ b·ªè qua l·ªói nh·ªè" -ForegroundColor Yellow
            }
            Start-Sleep -Milliseconds 500
          }
          
          Write-Host "üéØ C·∫•u h√¨nh ho√†n t·∫•t!" -ForegroundColor Green

      # üë§ T·∫†O T√ÄI KHO·∫¢N PREMIUM
      - name: üë§ T·∫†O T√ÄI KHO·∫¢N PREMIUM
        run: |
          Write-Host ""
          Write-Host "üë§ ƒêANG T·∫†O T√ÄI KHO·∫¢N PREMIUM" -ForegroundColor Yellow
          
          function New-PremiumPassword {
            $upper = 'ABCDEFGHJKLMNPQRSTUVWXYZ'
            $lower = 'abcdefghijkmnpqrstuvwxyz'
            $numbers = '23456789'
            $all = $upper + $lower + $numbers
            $pw = ''
            $pw += $upper[(Get-Random -Maximum $upper.Length)]
            $pw += $lower[(Get-Random -Maximum $lower.Length)]
            $pw += $numbers[(Get-Random -Maximum $numbers.Length)]
            for ($i = 1; $i -le 5; $i++) {
              $pw += $all[(Get-Random -Maximum $all.Length)]
            }
            return -join ($pw.ToCharArray() | Sort-Object {Get-Random})
          }

          if ($env:CUSTOM_RDP_PASS) {
            $matKhau = $env:CUSTOM_RDP_PASS
          } else {
            $matKhau = New-PremiumPassword
          }

          $securePass = ConvertTo-SecureString $matKhau -AsPlainText -Force
          
          try { Remove-LocalUser -Name "AISTV-PREMIUM" -ErrorAction SilentlyContinue } catch {}
          
          New-LocalUser -Name "AISTV-PREMIUM" -Password $securePass -AccountNeverExpires -Description "AI STV Premium Account"
          Set-LocalUser -Name "AISTV-PREMIUM" -PasswordNeverExpires $true -ErrorAction SilentlyContinue
          Add-LocalGroupMember -Group "Administrators" -Member "AISTV-PREMIUM"
          Add-LocalGroupMember -Group "Remote Desktop Users" -Member "AISTV-PREMIUM"
          Enable-LocalUser -Name "AISTV-PREMIUM"
          
          echo "RDP_USER=AISTV-PREMIUM" >> $env:GITHUB_ENV
          echo "RDP_PASS=$matKhau" >> $env:GITHUB_ENV
          echo "$matKhau" > $env:TEMP\rdp_password.txt
          
          Write-Host "‚úÖ T√†i kho·∫£n: AISTV-PREMIUM ƒë√£ s·∫µn s√†ng" -ForegroundColor Green

      # üîç KI·ªÇM TRA QUY·ªÄN H·ªÜ TH·ªêNG
      - name: üîç KI·ªÇM TRA QUY·ªÄN H·ªÜ TH·ªêNG
        run: |
          Write-Host ""
          Write-Host "üîç KI·ªÇM TRA QUY·ªÄN ƒêƒÇNG NH·∫¨P" -ForegroundColor Yellow
          
          $user = Get-LocalUser -Name "AISTV-PREMIUM" -ErrorAction SilentlyContinue
          if ($user) {
            Write-Host "‚îÇ ‚úÖ User AISTV-PREMIUM t·ªìn t·∫°i" -ForegroundColor Green
            Write-Host "‚îÇ üìä Tr·∫°ng th√°i: $($user.Enabled)" -ForegroundColor White
          } else {
            Write-Host "‚îÇ ‚ùå User kh√¥ng t·ªìn t·∫°i" -ForegroundColor Red
            exit 1
          }
          
          $isAdmin = (Get-LocalGroupMember -Group "Administrators" | Where-Object {$_.Name -like "*AISTV-PREMIUM"}).Count -gt 0
          if ($isAdmin) { Write-Host "‚îÇ ‚úÖ C√≥ quy·ªÅn Administrator" -ForegroundColor Green } 
          else { Write-Host "‚îÇ ‚ùå Kh√¥ng c√≥ quy·ªÅn Administrator" -ForegroundColor Red }
          
          $isRDPUser = (Get-LocalGroupMember -Group "Remote Desktop Users" | Where-Object {$_.Name -like "*AISTV-PREMIUM"}).Count -gt 0
          if ($isRDPUser) { Write-Host "‚îÇ ‚úÖ C√≥ quy·ªÅn Remote Desktop" -ForegroundColor Green } 
          else { Write-Host "‚îÇ ‚ùå Kh√¥ng c√≥ quy·ªÅn Remote Desktop" -ForegroundColor Red }
          
          $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
          if ($termService.Status -eq 'Running') { Write-Host "‚îÇ ‚úÖ D·ªãch v·ª• TermService ƒëang ch·∫°y" -ForegroundColor Green }
          else { Write-Host "‚îÇ ‚ùå D·ªãch v·ª• TermService kh√¥ng ch·∫°y" -ForegroundColor Red }
          
          Write-Host "üéØ Ki·ªÉm tra ho√†n t·∫•t!" -ForegroundColor Green

      # üåê THI·∫æT L·∫¨P M·∫†NG PREMIUM (TAILSCALE)
      - name: üåê THI·∫æT L·∫¨P M·∫†NG PREMIUM
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          Write-Host ""
          Write-Host "üåê ƒêANG THI·∫æT L·∫¨P K·∫æT N·ªêI M·∫†NG" -ForegroundColor Yellow
          
          $msiPath = "$env:TEMP\tailscale-premium.msi"
          Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi" -OutFile $msiPath
          Start-Process msiexec.exe -ArgumentList "/i", "`"$msiPath`"", "/quiet", "/norestart" -Wait
          Remove-Item $msiPath -Force -ErrorAction SilentlyContinue
          Write-Host "‚îÇ ‚úÖ C√†i ƒë·∫∑t Tailscale th√†nh c√¥ng" -ForegroundColor Green
          
          Start-Sleep -Seconds 10
          
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$env:TAILSCALE_AUTH_KEY --hostname=ai-stv-premium-$env:GITHUB_RUN_ID --accept-routes --accept-dns --reset
          Write-Host "‚îÇ ‚úÖ K·∫øt n·ªëi Tailscale th√†nh c√¥ng" -ForegroundColor Green
          
          Write-Host "üîÑ ƒêang l·∫•y ƒë·ªãa ch·ªâ IP..." -NoNewline -ForegroundColor Blue
          $ip = $null
          for($i=0; $i -lt 20; $i++) {
            try {
              $ip = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4 2>&1
              if (\( ip -match '^\d+\.\d+\.\d+\.\d+ \)') {
                echo "TAILSCALE_IP=$ip" >> $env:GITHUB_ENV
                Write-Host "`r‚úÖ ƒê·ªãa ch·ªâ IP: $ip" -ForegroundColor Green
                break
              }
            } catch {}
            Write-Host "`rüîÑ ƒêang l·∫•y ƒë·ªãa ch·ªâ IP... $(@('.', '..', '...')[$i % 3])" -NoNewline -ForegroundColor Blue
            Start-Sleep -Seconds 3
          }
          
          if (-not $ip -or \( ip -notmatch '^\d+\.\d+\.\d+\.\d+ \)') {
            Write-Host "`r‚ö†Ô∏è  Kh√¥ng th·ªÉ l·∫•y IP, d√πng localhost" -ForegroundColor Yellow
            echo "TAILSCALE_IP=localhost" >> $env:GITHUB_ENV
          }

      # üéâ TH√îNG TIN K·∫æT N·ªêI
      - name: üéâ TH√îNG TIN K·∫æT N·ªêI
        run: |
          $matKhau = Get-Content $env:TEMP\rdp_password.txt -ErrorAction SilentlyContinue
          if (-not $matKhau) { $matKhau = "Kh√¥ng th·ªÉ ƒë·ªçc m·∫≠t kh·∫©u" }
          
          \( durationInput = " \){{ github.event.inputs.duration }}"
          switch ($durationInput) {
            "1h" { $totalMinutes = 60; $displayTime = "1 gi·ªù" }
            "3h" { $totalMinutes = 180; $displayTime = "3 gi·ªù" }
            "5h40m" { $totalMinutes = 340; $displayTime = "5 gi·ªù 40 ph√∫t" }
          }
          
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê" -ForegroundColor Cyan
          Write-Host "‚îÇ              üéâ K·∫æT N·ªêI TH√ÄNH C√îNG!              ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ üåê  ƒê·ªãa ch·ªâ: $env:TAILSCALE_IP" -ForegroundColor White
          Write-Host "‚îÇ üë§  T√†i kho·∫£n: AISTV-PREMIUM" -ForegroundColor White
          Write-Host "‚îÇ üîê  M·∫≠t kh·∫©u: $matKhau" -ForegroundColor White
          Write-Host "‚îÇ ‚è∞  Th·ªùi l∆∞·ª£ng: $displayTime" -ForegroundColor White
          Write-Host "‚îÇ üïê  B·∫Øt ƒë·∫ßu: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üïê  K·∫øt th√∫c: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üìç  Port: 3389" -ForegroundColor White
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ üí°  H∆∞·ªõng d·∫´n:                                    ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îÇ   1. M·ªü Remote Desktop Connection                 ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   2. Nh·∫≠p: $env:TAILSCALE_IP                      ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   3. User: AISTV-PREMIUM | Password: tr√™n          ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   4. Enjoy! üöÄ                                    ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò" -ForegroundColor Cyan
          
          echo "TOTAL_MINUTES=$totalMinutes" >> $env:GITHUB_ENV

      # ‚è≥ DUY TR√å PHI√äN L√ÄM VI·ªÜC
      - name: ‚è≥ DUY TR√å PHI√äN L√ÄM VI·ªÜC
        run: |
          $matKhau = Get-Content $env:TEMP\rdp_password.txt -ErrorAction SilentlyContinue
          $totalMinutes = $env:TOTAL_MINUTES
          
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "üîÑ B·∫ÆT ƒê·∫¶U DUY TR√å PHI√äN L√ÄM VI·ªÜC..." -ForegroundColor Yellow
          Write-Host "üíé Phi√™n: AI STV PREMIUM" -ForegroundColor Magenta
          Write-Host "üîó K·∫øt n·ªëi: $env:TAILSCALE_IP" -ForegroundColor Cyan
          Write-Host "üïê B·∫Øt ƒë·∫ßu: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor Green
          Write-Host "üïê K·∫øt th√∫c: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor Green
          Write-Host ""
          
          $monitorScript = {
            $lastLogTime = Get-Date
            while ($true) {
              $currentTime = Get-Date
              if (($currentTime - $lastLogTime).TotalMinutes -ge 2) {
                $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
                $rdpConnections = Get-NetTCPConnection -LocalPort 3389 -ErrorAction SilentlyContinue | Where-Object {$_.State -eq 'Established'}
                Write-Host "[$($currentTime.ToString('HH:mm:ss'))] üìä RDP: $($termService.Status), K·∫øt n·ªëi: $($rdpConnections.Count)" -ForegroundColor Blue
                $lastLogTime = $currentTime
              }
              $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
              if ($termService.Status -ne 'Running') {
                Write-Host "[$($currentTime.ToString('HH:mm:ss'))] üîÑ Kh·ªüi ƒë·ªông l·∫°i TermService..." -ForegroundColor Yellow
                Start-Service -Name TermService -ErrorAction SilentlyContinue
              }
              Start-Sleep -Seconds 30
            }
          }
          
          Start-Job -ScriptBlock $monitorScript -Name "SystemMonitor"
          
          $frames = @('‚†ã', '‚†ô', '‚†π', '‚†∏', '‚†º', '‚†¥', '‚†¶', '‚†ß', '‚†á', '‚†è')
          $colors = @('Red', 'Yellow', 'Green', 'Cyan', 'Blue', 'Magenta')
          $startTime = Get-Date
          
          do {
            $thoiGianHienTai = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
            $thoiGianConLai = $thoiGianKetThuc - $thoiGianHienTai
            $gioConLai = [math]::Floor($thoiGianConLai.TotalHours)
            $phutConLai = [math]::Floor($thoiGianConLai.TotalMinutes % 60)
            $giayConLai = [math]::Floor($thoiGianConLai.TotalSeconds % 60)
            $frame = $frames[([int]((Get-Date) - $startTime).TotalSeconds % $frames.Length)]
            $color = $colors[([int]((Get-Date) - $startTime).TotalMinutes % $colors.Length)]
            Write-Host "`r\( frame [ \)($thoiGianHienTai.ToString('HH:mm:ss'))] C√≤n l·∫°i: $gioConLai gi·ªù $phutConLai ph√∫t $giayConLai gi√¢y" -NoNewline -ForegroundColor $color
            Start-Sleep -Seconds 5
          } while ($thoiGianConLai.TotalSeconds -gt 0)
          
          Write-Host ""
          Write-Host "üéØ ƒê√É H·∫æT TH·ªúI GIAN - T·ª∞ ƒê·ªòNG D·ª™NG!" -ForegroundColor Red
          Get-Job -Name "SystemMonitor" -ErrorAction SilentlyContinue | Stop-Job -PassThru | Remove-Job -Force

      # üßπ D·ªåN D·∫∏P H·ªÜ TH·ªêNG
      - name: üßπ D·ªåN D·∫∏P H·ªÜ TH·ªêNG
        if: always()
        run: |
          Write-Host ""
          Write-Host "üßπ ƒêANG D·ªåN D·∫∏P H·ªÜ TH·ªêNG..." -ForegroundColor Yellow
          
          Remove-Item "$env:TEMP\rdp_password.txt" -ErrorAction SilentlyContinue
          Disable-LocalUser -Name "AISTV-PREMIUM" -ErrorAction SilentlyContinue
          & "$env:ProgramFiles\Tailscale\tailscale.exe" down --accept-risk=all -ErrorAction SilentlyContinue
          Start-Sleep -Seconds 5
          netsh advfirewall firewall delete rule name="RDP-Premium" dir=in -ErrorAction SilentlyContinue
          netsh advfirewall firewall delete rule name="RDP-Premium-Out" dir=out -ErrorAction SilentlyContinue
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 1 -Force -ErrorAction SilentlyContinue
          Stop-Service -Name TermService -Force -ErrorAction SilentlyContinue
          
          Write-Host "üßπ D·ªçn d·∫πp ho√†n t·∫•t!" -ForegroundColor Green
